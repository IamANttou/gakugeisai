<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>スロット＋クリッカー</title>
<style>
  body{
    margin:0;
    background:#111;
    color:#fff;
    font-family:sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .main{
    display:flex;
    width:100%;
    height:80vh;
  }
  .left,.right{
    width:50%;
    padding:10px;
    box-sizing:border-box;
  }
  .wrap{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    grid-template-rows:repeat(3,1fr);
    gap:5px;
    width:100%;
    aspect-ratio:8/5;
    background:#222;
    margin-bottom:10px;
  }
  .cell{
    background:#333;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
  }
  .cell img{
    max-width:100%;
    max-height:100%;
  }
  .controls{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin:10px 0;
  }
  .controls button{
    padding:8px 16px;
    font-size:1rem;
    border:none;
    border-radius:8px;
    cursor:pointer;
    background:#0af;
    color:#fff;
  }
  .hand{
    display:flex;
    gap:5px;
    flex-wrap:wrap;
  }
  .card{
    width:70px;
    aspect-ratio:5/8;
    background:#444;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:6px;
    font-size:0.8rem;
  }
  .status{
    margin-top:10px;
    text-align:center;
  }
  .right{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
  }
  #clickImg{
    width:150px;
    cursor:pointer;
  }
  .upgrade{
    margin-top:20px;
    display:flex;
    gap:10px;
  }
  .upgrade button{
    padding:6px 12px;
    border:none;
    border-radius:6px;
    background:#fa0;
    cursor:pointer;
    font-size:0.9rem;
  }
</style>
</head>
<body>
<div class="main">
  <!-- スロット左 -->
  <div class="left">
    <div class="wrap" id="slot"></div>
    <div class="controls">
      <button id="spinBtn">スピン</button>
      <button id="stopCol1">列1停止</button>
      <button id="stopCol2">列2停止</button>
      <button id="stopCol3">列3停止</button>
      <input type="number" id="betInput" value="1" min="1" style="width:60px;">
      <button id="bet10">10ベット</button>
    </div>
    <div class="hand" id="hand"></div>
  </div>

  <!-- クリッカー右 -->
  <div class="right">
    <h2>クリッカー</h2>
    <img src="images/click1.png" id="clickImg">
    <div class="upgrade">
      <button onclick="upgradeClick()">クリック強化(-3マナ)</button>
      <button onclick="upgradeAuto()">自動強化(-5マナ)</button>
    </div>
    <p id="clickStatus">クリック+1 / 自動+0</p>
  </div>
</div>

<!-- 共通ステータス -->
<div class="status">
  コイン: <span id="coin">100</span> | 
  マナ: <span id="mana">0</span>
</div>

<script>
// ====== 共通リソース ======
let coin=100;
let mana=0;
let bet=1;
let turn=0;
let isSpinning=false;

// ====== スロット関連 ======
const slot=document.getElementById("slot");
const rows=3, cols=3;
let reels=[[],[],[]];
const images=[...Array(9)].map((_,i)=>`images/slot${i+1}.png`);

for(let r=0;r<rows;r++){
  for(let c=0;c<cols;c++){
    const div=document.createElement("div");
    div.className="cell";
    const img=document.createElement("img");
    img.src=images[Math.floor(Math.random()*images.length)];
    div.appendChild(img);
    slot.appendChild(div);
    reels[c].push(img);
  }
}

function spin(){
  if(isSpinning) return;
  if(coin<bet) return;
  coin-=bet;
  document.getElementById("coin").textContent=coin;
  isSpinning=true;
  spinIntervals=[];
  for(let c=0;c<cols;c++){
    spinIntervals[c]=setInterval(()=>{
      for(let r=0;r<rows;r++){
        reels[c][r].src=images[Math.floor(Math.random()*images.length)];
      }
    },100);
  }
}

function stopCol(c){
  if(!isSpinning) return;
  clearInterval(spinIntervals[c]);
  spinIntervals[c]=null;
  if(spinIntervals.every(x=>x===null)){
    isSpinning=false;
    checkWin();
    endTurn();
  }
}

function checkWin(){
  let reward=0;
  let lines=[];
  // 横
  for(let r=0;r<rows;r++){
    if(reels[0][r].src===reels[1][r].src && reels[1][r].src===reels[2][r].src){
      reward+=bet*5;
      lines.push("横");
    }
  }
  // 縦
  for(let c=0;c<cols;c++){
    if(reels[c][0].src===reels[c][1].src && reels[c][1].src===reels[c][2].src){
      reward+=bet*5;
      lines.push("縦");
    }
  }
  // 斜め
  if(reels[0][0].src===reels[1][1].src && reels[1][1].src===reels[2][2].src){
    reward+=bet*5;
    lines.push("斜め");
  }
  if(reels[0][2].src===reels[1][1].src && reels[1][1].src===reels[2][0].src){
    reward+=bet*5;
    lines.push("斜め");
  }
  // ダブル効果
  if(doubleActive){
    reward*=2;
    doubleActive=false;
  }
  // 保険効果
  if(reward===0 && insuranceActive){
    coin+=bet;
    insuranceActive=false;
  }else{
    coin+=reward;
  }
  document.getElementById("coin").textContent=coin;
}

// ====== カード関連 ======
let hand=[];
let doubleActive=false;
let insuranceActive=false;

function addCard(type){ hand.push(type); renderHand(); }
function renderHand(){
  const h=document.getElementById("hand");
  h.innerHTML="";
  hand.forEach((card,i)=>{
    const div=document.createElement("div");
    div.className="card";
    div.textContent=card;
    div.onclick=()=>useCard(i);
    h.appendChild(div);
  });
}
function useCard(i){
  const card=hand[i];
  if(card==="coinplus" && mana>=1){ coin+=5; mana--; }
  if(card==="manarecover" && mana>=1){ mana--; mana+=2; }
  if(card==="double" && mana>=2){ mana-=2; doubleActive=true; }
  if(card==="draw" && mana>=1){ mana--; addCard(randomCard()); }
  if(card==="reroll" && mana>=2){ mana-=2; /* 未実装: reroll */ }
  if(card==="insurance" && mana>=2){ mana-=2; insuranceActive=true; }
  if(card==="superspin" && mana>=3){ mana-=3; spin(); setTimeout(spin,600); setTimeout(spin,1200); }
  hand.splice(i,1);
  renderHand();
  updateStatus();
}
function randomCard(){
  const list=["coinplus","manarecover","double","draw","reroll","insurance","superspin"];
  return list[Math.floor(Math.random()*list.length)];
}

function endTurn(){
  turn++;
  mana++;
  if(hand.length<7) addCard(randomCard());
  updateStatus();
}

// ====== クリッカー関連 ======
let clickPower=1;
let autoPower=0;

const clickImg=document.getElementById("clickImg");
clickImg.onclick=()=>{
  coin+=clickPower;
  document.getElementById("coin").textContent=coin;
};

setInterval(()=>{
  coin+=autoPower;
  document.getElementById("coin").textContent=coin;
},1000);

function upgradeClick(){
  if(mana>=3){
    mana-=3;
    clickPower++;
    updateStatus();
  }
}
function upgradeAuto(){
  if(mana>=5){
    mana-=5;
    autoPower++;
    updateStatus();
  }
}

function updateStatus(){
  document.getElementById("coin").textContent=coin;
  document.getElementById("mana").textContent=mana;
  document.getElementById("clickStatus").textContent=`クリック+${clickPower} / 自動+${autoPower}`;
}

// ====== イベント ======
document.getElementById("spinBtn").onclick=spin;
document.getElementById("stopCol1").onclick=()=>stopCol(0);
document.getElementById("stopCol2").onclick=()=>stopCol(1);
document.getElementById("stopCol3").onclick=()=>stopCol(2);
document.getElementById("betInput").onchange=(e)=>{ bet=parseInt(e.target.value); };
document.getElementById("bet10").onclick=()=>{ bet=10; document.getElementById("betInput").value=10; };

// 初期カード
addCard(randomCard());
updateStatus();
</script>
</body>
</html>
