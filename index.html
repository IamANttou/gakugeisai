<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>1to9 slot</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#071428;color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh}
    .wrap{width:100%;max-width:760px;padding:20px}
    h1{margin:0 0 10px}
    .status{display:flex;gap:12px;align-items:center;margin-bottom:10px}
    .grid{display:grid;grid-template-columns:repeat(3,120px);grid-gap:8px;justify-content:center}
    .cell{width:120px;height:120px;background:#0c1a2a;border-radius:8px;display:flex;align-items:center;justify-content:center;border:3px solid transparent;overflow:hidden}
    .cell img{width:100%;height:100%;object-fit:cover}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
    button{padding:10px 14px;border:none;border-radius:6px;background:#f59e0b;color:#000;font-weight:700;cursor:pointer}
    input[type=number]{width:100px;padding:8px;border-radius:6px;border:1px solid #334}
    #result{margin-top:12px;color:#dce}
    .highlight{box-shadow:0 0 0 4px rgba(16,185,129,0.12);border-color:#10b981}
    .payline-label{font-size:13px;color:#9fb}
    @media(max-width:520px){.grid{grid-template-columns:repeat(3,28vw)}.cell{height:28vw}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>1to9 slot</h1>

    <div class="status">
      <div>所持コイン: <strong id="coins">100</strong></div>
      <div class="payline-label">ベット（1スピン）: <input id="bet" type="number" value="10" min="1"></div>
      <div class="payline-label">勝ち判定: 横3 / 縦3 / 斜め3 が揃えば当たり</div>
    </div>

    <div class="grid" id="grid">
      <!-- 3x3 のセルを自動生成 -->
    </div>

    <div class="controls">
      <button id="spin">SPIN</button>
    </div>

    <div id="result"></div>
  </div>

  <script>
    // 所持コインとベット
    let coins = 100
    const coinsEl = document.getElementById('coins')
    const betInput = document.getElementById('bet')
    const resultEl = document.getElementById('result')

    // 固定シンボル（管理者が GitHub で画像を設定）
    const symbols = [
      'images/slot1.png',
      'images/slot2.png',
      'images/slot3.png',
      'images/slot4.png',
      'images/slot5.png',
      'images/slot6.png',
      'images/slot7.png',
      'images/slot8.png',
      'images/slot9.png'
    ]

    const gridEl = document.getElementById('grid')
    // 3x3セルを作る
    for(let r=0;r<3;r++){
      for(let c=0;c<3;c++){
        const cell = document.createElement('div')
        cell.className='cell'
        cell.id = `cell-${r}-${c}`
        cell.innerHTML = `<img src="${symbols[(r*3+c)%symbols.length]}" alt="symbol">`
        gridEl.appendChild(cell)
      }
    }

    function updateGridWithIndices(indices){
      for(let r=0;r<3;r++){
        for(let c=0;c<3;c++){
          const idx = indices[r][c]
          const img = gridEl.querySelector(`#cell-${r}-${c} img`)
          img.src = symbols[idx]
          img.alt = `sym-${idx}`
          gridEl.querySelector(`#cell-${r}-${c}`).classList.remove('highlight')
        }
      }
    }

    function randomIndices(){
      const n = symbols.length
      const out = []
      for(let r=0;r<3;r++){
        const row = []
        for(let c=0;c<3;c++){
          row.push(Math.floor(Math.random()*n))
        }
        out.push(row)
      }
      return out
    }

    function checkPaylines(indices){
      const wins = []
      // rows
      for(let r=0;r<3;r++){
        const a = indices[r][0], b = indices[r][1], c = indices[r][2]
        if(a===b && b===c) wins.push({name:`横 ${r+1}`, cells:[{r,c:0},{r,c:1},{r,c:2}], symbolIndex:a})
      }
      // cols
      for(let c=0;c<3;c++){
        const a = indices[0][c], b = indices[1][c], c2 = indices[2][c]
        if(a===b && b===c2) wins.push({name:`縦 ${c+1}`, cells:[{r:0,c},{r:1,c},{r:2,c}], symbolIndex:a})
      }
      // diag TL-BR
      if(indices[0][0]===indices[1][1] && indices[1][1]===indices[2][2]){
        wins.push({name:'斜め ↘', cells:[{r:0,c:0},{r:1,c:1},{r:2,c:2}], symbolIndex:indices[1][1]})
      }
      // diag BL-TR
      if(indices[2][0]===indices[1][1] && indices[1][1]===indices[0][2]){
        wins.push({name:'斜め ↗', cells:[{r:2,c:0},{r:1,c:1},{r:0,c:2}], symbolIndex:indices[1][1]})
      }
      return wins
    }

    const PAY_MULTIPLIER = 5

    document.getElementById('spin').addEventListener('click', ()=>{
      const bet = parseInt(betInput.value,10)
      if(isNaN(bet) || bet<=0){alert('ベット額を正しく入力してください');return}
      if(bet>coins){alert('コインが足りません');return}

      coins -= bet
      coinsEl.textContent = coins

      const indices = randomIndices()
      updateGridWithIndices(indices)

      const wins = checkPaylines(indices)
      let totalWin = 0
      if(wins.length>0){
        totalWin = wins.length * bet * PAY_MULTIPLIER
        coins += totalWin
        coinsEl.textContent = coins
        wins.forEach(w=>{
          w.cells.forEach(cell=>{
            gridEl.querySelector(`#cell-${cell.r}-${cell.c}`).classList.add('highlight')
          })
        })
      }

      resultEl.innerHTML = ''
      if(wins.length>0){
        resultEl.innerHTML = `<div style="color:lime">当たり！ ${wins.length} ラインで +${totalWin}コイン</div>`
        resultEl.innerHTML += `<div style="margin-top:6px">勝ちライン: ${wins.map(w=>w.name).join(', ')}</div>`
      } else {
        resultEl.innerHTML = `<div style="color:#aaa">はずれ</div>`
      }

      setTimeout(()=>{
        document.querySelectorAll('.cell').forEach(el=>el.classList.remove('highlight'))
      },1500)
    })

    // 初期グリッドは先頭9つのシンボルで配置
    updateGridWithIndices([[0,1,2],[3,4,5],[6,7,8]])
    coinsEl.textContent = coins
  </script>
</body>
</html>
