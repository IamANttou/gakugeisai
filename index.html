<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>1to9 slot</title>
  <style>
    body{
      margin:0;
      font-family:sans-serif;
      background:#0f1724;
      color:#fff;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      min-height:100vh;
    }

    h1{
      margin:10px 0;
      font-size:28px;
      color:#facc15;
    }

    /* ステータス横並び */
    .status{
      display:flex;
      gap:20px;
      margin:6px 0;
      font-size:18px;
      font-weight:bold;
    }

    /* スロットエリア：画面の1/4サイズ */
    .slot-area{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      grid-template-rows:repeat(3,1fr);
      width:25vw;   /* 画面幅の1/4 */
      height:25vw;  /* 正方形で1/4 */
      gap:6px;      /* セルの間隔を狭めすぎず */
      margin:8px 0;
    }
    .cell{
      background:#111;
      border:2px solid #555;
      border-radius:6px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .cell img{
      width:100%;
      height:100%;
      object-fit:cover;
    }

    /* パネル（ボタン） */
    .panel{
      display:flex;
      gap:8px;
      margin:6px 0;
    }
    button{
      padding:8px 14px;
      border:none;
      border-radius:6px;
      background:#f59e0b;
      color:#000;
      font-weight:bold;
      cursor:pointer;
      font-size:14px;
    }

    /* 手札 */
    .hand{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      justify-content:center;
      margin:6px 0;
    }
    .card{
      width:100px;
      aspect-ratio:5/8; /* 縦長カード */
      background:#222;
      border:2px solid #999;
      border-radius:8px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      font-size:12px;
      cursor:pointer;
      overflow:hidden;
    }
    .card img{
      width:100%;
      height:auto;
      object-fit:cover;
    }
  </style>
</head>
<body>
  <h1>1to9 slot</h1>

  <div class="status">
    <div id="coins">コイン: 0</div>
    <div id="mana">マナ: 0</div>
    <div id="best">自己ベスト: 0</div>
    <div id="effect">効果: なし</div>
  </div>

  <div class="slot-area" id="slot"></div>

  <div class="panel">
    <button id="spin">SPIN</button>
    <button id="stop-0">STOP 1列目</button>
    <button id="stop-1">STOP 2列目</button>
    <button id="stop-2">STOP 3列目</button>
  </div>

  <div class="hand" id="hand"></div>

  <script>
    const rows=3, cols=3;
    const symbols=[
      "images/slot1.png","images/slot2.png","images/slot3.png",
      "images/slot4.png","images/slot5.png","images/slot6.png",
      "images/slot7.png","images/slot8.png","images/slot9.png"
    ];

    let coins=0, mana=0, best=0;
    let lastSpinResults=[[0,0,0],[0,0,0],[0,0,0]];
    let spinIntervals=[null,null,null];
    let wildActive=false;

    const slotArea=document.getElementById("slot");
    const resultEl=document.getElementById("effect");
    const handEl=document.getElementById("hand");

    function buildGrid(results){
      slotArea.innerHTML="";
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          const cell=document.createElement("div");
          cell.className="cell";
          const idx=results[r][c];
          cell.innerHTML=`<img src="${symbols[idx]}">`;
          slotArea.appendChild(cell);
        }
      }
    }

    function spinReel(col){
      spinIntervals[col]=setInterval(()=>{
        for(let r=0;r<rows;r++){
          lastSpinResults[r][col]=Math.floor(Math.random()*symbols.length);
        }
        buildGrid(lastSpinResults);
      },100);
    }

    function stopReel(col){
      if(spinIntervals[col]){
        clearInterval(spinIntervals[col]);
        spinIntervals[col]=null;
      }
      if(spinIntervals.every(v=>v===null)){
        checkWin();
      }
    }

    document.getElementById("spin").addEventListener("click",()=>{
      for(let c=0;c<cols;c++){ spinReel(c); }
    });
    document.getElementById("stop-0").addEventListener("click",()=>stopReel(0));
    document.getElementById("stop-1").addEventListener("click",()=>stopReel(1));
    document.getElementById("stop-2").addEventListener("click",()=>stopReel(2));

    function checkWin(){
      let reward=0;
      // 横
      for(let r=0;r<rows;r++){
        if(lastSpinResults[r][0]===lastSpinResults[r][1] && lastSpinResults[r][1]===lastSpinResults[r][2]){
          reward+=25;
        }
      }
      // 縦
      for(let c=0;c<cols;c++){
        if(lastSpinResults[0][c]===lastSpinResults[1][c] && lastSpinResults[1][c]===lastSpinResults[2][c]){
          reward+=25;
        }
      }
      // 斜め
      if(lastSpinResults[0][0]===lastSpinResults[1][1] && lastSpinResults[1][1]===lastSpinResults[2][2]){
        reward+=25;
      }
      if(lastSpinResults[0][2]===lastSpinResults[1][1] && lastSpinResults[1][1]===lastSpinResults[2][0]){
        reward+=25;
      }
      coins+=reward;
      if(coins>best) best=coins;
      updateStatus();
    }

    function updateStatus(){
      document.getElementById("coins").innerText="コイン: "+coins;
      document.getElementById("mana").innerText="マナ: "+mana;
      document.getElementById("best").innerText="自己ベスト: "+best;
    }

    // 初期表示
    buildGrid(lastSpinResults);
    updateStatus();
  </script>
</body>
</html>
