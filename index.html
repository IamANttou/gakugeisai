<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Clicker Card Slot 1to9</title>
  <style>
    body {
      background:#222;
      color:white;
      font-family:sans-serif;
      margin:0;
      overflow:hidden;
    }
    .topbar {
      width:100%;
      background:#333;
      padding:10px;
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    .xp-bar {
      width:80%;
      height:20px;
      background:#555;
      border-radius:10px;
      overflow:hidden;
      margin:5px 0;
    }
    .xp-fill {
      height:100%;
      background:limegreen;
      width:0%;
    }
    .wrap {
      display:flex;
      flex-direction:row;
      width:100%;
      height:calc(100vh - 80px);
      transform-origin: top center;
      justify-content:space-between;
    }
    .slot-area {
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
    }
    .reels {
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:5px;
      width:90%;
      max-width:500px;
    }
    .cell {
      aspect-ratio:8/5;
      background:#111;
      border:2px solid #444;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .cell img {
      width:100%;
      height:100%;
      object-fit:contain;
    }
    .controls {
      margin-top:10px;
      display:flex;
      gap:10px;
    }
    .controls button {
      padding:10px 20px;
      font-size:16px;
      font-weight:bold;
      border:none;
      border-radius:8px;
      cursor:pointer;
    }
    .spin-btn { background:red; color:white; }
    .stop-btn { background:yellow; color:black; }
    .upgrade-btn { background:blue; color:white; }

    .right-side {
      flex:1;
      display:flex;
      flex-direction:column;
    }
    .clicker {
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
    }
    .clicker img {
      width:200px;
      aspect-ratio:1/1;
      object-fit:contain;
      border-radius:50%;
      cursor:pointer;
    }
    .upgrades {
      margin-top:10px;
      display:flex;
      flex-direction:column;
      gap:5px;
      align-items:center;
    }
    .skilltree {
      flex:1;
      background:#333;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:10px;
      overflow:auto;
    }
    .skilltree button {
      margin:5px;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div>コイン: <span id="coins">100</span> ｜ マナ: <span id="mana">0</span> ｜ Lv: <span id="level">1</span> ｜ XP: <span id="xp">0</span>/<span id="xpMax">5</span> ｜ SP: <span id="sp">0</span></div>
    <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
  </div>
  <div class="wrap">
    <!-- Slot -->
    <div class="slot-area">
      <div class="reels" id="reels"></div>
      <div class="controls">
        <button class="spin-btn" id="spinBtn">スピン</button>
        <button class="stop-btn" id="stop1">停止1</button>
        <button class="stop-btn" id="stop2">停止2</button>
        <button class="stop-btn" id="stop3">停止3</button>
      </div>
    </div>
    <!-- Right side -->
    <div class="right-side">
      <div class="clicker">
        <img id="clickImg" src="images/click1.png" alt="click">
        <div class="upgrades">
          <button class="upgrade-btn" id="upgradeClick">クリック+1 (コスト:<span id="clickCost">2</span>)</button>
          <button class="upgrade-btn" id="upgradeAuto">自動+1/s (コスト:<span id="autoCost">3</span>)</button>
          <button class="upgrade-btn" id="upgradeCrit">クリティカル+1% (コスト:<span id="critCost">5</span>)</button>
        </div>
      </div>
      <div class="skilltree">
        <h3>スキルツリー</h3>
        <button class="upgrade-btn" id="skill1">スロット配当+10%</button>
        <button class="upgrade-btn" id="skill2">クリック効果+10%</button>
        <button class="upgrade-btn" id="skill3">マナ獲得+1/ターン</button>
      </div>
    </div>
  </div>

  <script>
    // 基本ステータス
    let coins=100, mana=0, level=1, xp=0, xpMax=5, sp=0;
    let clickPower=1, autoPower=0, critChance=0;
    let clickCost=2, autoCost=3, critCost=5;

    // UI更新
    function updateUI(){
      document.getElementById("coins").innerText=coins;
      document.getElementById("mana").innerText=mana;
      document.getElementById("level").innerText=level;
      document.getElementById("xp").innerText=xp;
      document.getElementById("xpMax").innerText=xpMax;
      document.getElementById("sp").innerText=sp;
      document.getElementById("xpFill").style.width=(xp/xpMax*100)+"%";
      document.getElementById("clickCost").innerText=clickCost;
      document.getElementById("autoCost").innerText=autoCost;
      document.getElementById("critCost").innerText=critCost;
    }

    // レベルアップ処理
    function gainXP(amount){
      xp+=amount;
      if(xp>=xpMax){
        xp-=xpMax;
        level++;
        xpMax=level*5;
        coins+=10;
        mana+=2;
        sp++;
      }
      updateUI();
    }

    // クリック処理
    document.getElementById("clickImg").addEventListener("click",()=>{
      let gain=clickPower;
      if(Math.random()*100<critChance) gain*=2;
      coins+=gain;
      updateUI();
    });

    // 自動クリック
    setInterval(()=>{
      coins+=autoPower;
      updateUI();
    },1000);

    // アップグレード
    document.getElementById("upgradeClick").addEventListener("click",()=>{
      if(mana>=clickCost){
        mana-=clickCost;
        clickPower++;
        clickCost+= (level-1);
        updateUI();
      }
    });
    document.getElementById("upgradeAuto").addEventListener("click",()=>{
      if(mana>=autoCost){
        mana-=autoCost;
        autoPower++;
        autoCost+= (level-1);
        updateUI();
      }
    });
    document.getElementById("upgradeCrit").addEventListener("click",()=>{
      if(mana>=critCost){
        mana-=critCost;
        critChance++;
        critCost+= (level-1);
        updateUI();
      }
    });

    // スキルツリー
    document.getElementById("skill1").addEventListener("click",()=>{
      if(sp>0){ sp--; /*配当UP*/ updateUI(); }
    });
    document.getElementById("skill2").addEventListener("click",()=>{
      if(sp>0){ sp--; clickPower+=0.1; updateUI(); }
    });
    document.getElementById("skill3").addEventListener("click",()=>{
      if(sp>0){ sp--; mana+=1; updateUI(); }
    });

    // スロット初期化
    const reels=document.getElementById("reels");
    const symbols=["slot1","slot2","slot3","slot4","slot5","slot6","slot7","slot8","slot9"];
    let spinning=false, reelIntervals=[];
    for(let i=0;i<9;i++){
      const cell=document.createElement("div");
      cell.className="cell";
      const img=document.createElement("img");
      img.src=`images/${symbols[Math.floor(Math.random()*symbols.length)]}.png`;
      cell.appendChild(img);
      reels.appendChild(cell);
    }

    function startSpin(){
      if(spinning) return;
      spinning=true;
      coins-=20;
      updateUI();
      for(let r=0;r<3;r++){
        reelIntervals[r]=setInterval(()=>{
          for(let y=0;y<3;y++){
            const idx=r+y*3;
            reels.children[idx].querySelector("img").src=`images/${symbols[Math.floor(Math.random()*symbols.length)]}.png`;
          }
        },100);
      }
    }

    function stopReel(r){
      if(!spinning) return;
      clearInterval(reelIntervals[r-1]);
      reelIntervals[r-1]=null;
      if(reelIntervals.every(v=>v===null)){
        spinning=false;
        checkWin();
      }
    }

    function checkWin(){
      const g=[...reels.children].map(c=>c.querySelector("img").src.split("/").pop());
      let win=false;
      // 横縦斜め
      for(let y=0;y<3;y++){
        if(g[y*3]===g[y*3+1]&&g[y*3]===g[y*3+2]){win=true;}
      }
      for(let x=0;x<3;x++){
        if(g[x]===g[x+3]&&g[x]===g[x+6]){win=true;}
      }
      if(g[0]===g[4]&&g[0]===g[8]) win=true;
      if(g[2]===g[4]&&g[2]===g[6]) win=true;

      if(win){
        coins+=20*5*2;
        gainXP(2);
      }
      if(coins>=100) gainXP(2);
      updateUI();
    }

    document.getElementById("spinBtn").addEventListener("click",startSpin);
    document.getElementById("stop1").addEventListener("click",()=>stopReel(1));
    document.getElementById("stop2").addEventListener("click",()=>stopReel(2));
    document.getElementById("stop3").addEventListener("click",()=>stopReel(3));

    updateUI();
  </script>
</body>
</html>
