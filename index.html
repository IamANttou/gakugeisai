<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clicker Card Slot 1to9</title>
<style>
body{
  margin:0;
  padding:0;
  background:#222;
  color:#fff;
  font-family:sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
}

/* 上部ステータス */
.top-status{
  width:95%;
  margin:10px;
}
.bar{
  background:#555;
  border-radius:6px;
  overflow:hidden;
  height:18px;
  margin:6px 0;
}
.bar-inner{
  background:#0f0;
  height:100%;
  width:0%;
  text-align:center;
  font-size:0.8rem;
  color:#000;
}

/* 2カラム */
.main{
  display:flex;
  width:95%;
  flex:1;
  gap:8px;
}
.left{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
}
.right{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* スロットエリア */
.slot-area{
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  gap:6px;
  width:100%;
}
.cell{
  aspect-ratio:8/5;
  border:2px solid #444;
  border-radius:6px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#111;
  overflow:hidden;
}
.cell img{ width:100%; height:100%; object-fit:contain; }

.status{ display:flex; gap:20px; font-size:1.08rem; justify-content:center; align-items:center; width:100%; border-top:3px solid #0f0; padding-top:8px; }

.hand{ display:flex; justify-content:center; gap:8px; flex-wrap:wrap; width:100%; border:3px solid #c33; padding:8px; border-radius:8px; }
.card{ aspect-ratio:5/8; width:72px; background:#333; border:2px solid #666; border-radius:6px; display:flex; align-items:center; justify-content:center; cursor:pointer; }
.card img{ width:100%; height:100%; object-fit:contain; }

#spinBtn{ margin:12px; padding:10px 22px; font-size:1.2rem; cursor:pointer; border:none; border-radius:12px; background:linear-gradient(145deg,#0a0,#0d0); color:#fff; font-weight:bold; box-shadow:0 4px 8px rgba(0,0,0,0.6); transition:transform 0.1s; }
#spinBtn:active{ transform:scale(0.95); }
#spinBtn:disabled{ opacity:0.6; cursor:not-allowed; }

.stop-buttons{ display:flex; justify-content:center; gap:20px; margin:10px; }
.stopBtn{ padding:6px 12px; font-size:0.9rem; border:none; border-radius:6px; background:#c33; color:#fff; cursor:pointer; }
.stopBtn:disabled{ background:#555; cursor:not-allowed; }

/* クリッカー */
.clicker{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  transform:scale(1.5);
  transform-origin:top center;
}
#clickImg{ width:120px; height:120px; border-radius:50%; cursor:pointer; }
.click-upgrades{ display:flex; flex-direction:column; gap:6px; font-size:0.9rem; }

/* スキルツリー */
.skilltree{
  border:2px solid #888;
  border-radius:8px;
  padding:8px;
  flex:1;
  overflow-y:auto;
}
.skilltree h3{ margin:4px 0; font-size:1.1rem; text-align:center; }
.skill-btn{ margin:4px 0; padding:6px; width:100%; border:none; border-radius:6px; background:#08f; color:#fff; cursor:pointer; font-size:0.9rem; }
.skill-btn:disabled{ background:#444; cursor:not-allowed; }
</style>
</head>
<body>

<div class="top-status">
  <div>Lv: <span id="level">1</span> | XP: <span id="xp">0</span>/<span id="xpNeeded">5</span> | スキルP: <span id="skillPoint">0</span></div>
  <div class="bar"><div class="bar-inner" id="xpBar"></div></div>
</div>

<div class="main">
  <!-- 左：スロット -->
  <div class="left">
    <div class="slot-area">
      <div class="cell" id="cell0"></div>
      <div class="cell" id="cell1"></div>
      <div class="cell" id="cell2"></div>
      <div class="cell" id="cell3"></div>
      <div class="cell" id="cell4"></div>
      <div class="cell" id="cell5"></div>
      <div class="cell" id="cell6"></div>
      <div class="cell" id="cell7"></div>
      <div class="cell" id="cell8"></div>
    </div>
    <div class="stop-buttons">
      <button class="stopBtn" id="stop0" disabled>左リール停止</button>
      <button class="stopBtn" id="stop1" disabled>中リール停止</button>
      <button class="stopBtn" id="stop2" disabled>右リール停止</button>
    </div>
    <div>
      ベッド固定:20
      <button id="spinBtn">スピン</button>
    </div>
    <div class="status">
      <div>コイン: <span id="coin">100</span></div>
      <div>マナ: <span id="mana">0</span></div>
    </div>
    <div class="hand" id="hand"></div>
  </div>

  <!-- 右：クリッカー + スキルツリー -->
  <div class="right">
    <div class="clicker">
      <img id="clickImg" src="images/click1.png">
      <div>クリックで+<span id="clickPower">1</span> コイン</div>
      <div>自動: <span id="autoPower">0</span>/s</div>
      <div>クリティカル率: <span id="critRate">0</span>% 倍率: <span id="critMult">2</span>x</div>
      <div class="click-upgrades">
        <button id="upgradeClick">クリック強化 (コスト:<span id="clickCost">2</span>)</button>
        <button id="upgradeAuto">自動強化 (コスト:<span id="autoCost">3</span>)</button>
      </div>
    </div>

    <div class="skilltree">
      <h3>スキルツリー</h3>
      <button class="skill-btn" id="skillCritRate">クリティカル率UP (+1%)</button>
      <button class="skill-btn" id="skillCritMult">クリティカル倍率UP (+0.5x)</button>
      <button class="skill-btn" id="skillAutoSpeed">オート速度UP (+1/s)</button>
      <button class="skill-btn" id="skillClickGain">クリック収益UP (+1)</button>
      <button class="skill-btn" id="skillManaGain">ターン終了マナ+1</button>
    </div>
  </div>
</div>

<script>
let coin=100, mana=0;
let hand=[], deck=[], discard=[];
let spinning=[false,false,false];
let spinIntervals=[null,null,null];

let level=1, xp=0, xpNeeded=5, skillPoint=0;
let clickPower=1, autoPower=0;
let clickCost=2, autoCost=3;
let critRate=0, critMult=2;
let manaBonusPerTurn=0;

const symbols=["images/slot1.png","images/slot2.png","images/slot3.png","images/slot4.png","images/slot5.png","images/slot6.png","images/slot7.png","images/slot8.png","images/slot9.png"];

const cardTypes=[
  {img:"images/card1.png", type:"reroll", cost:2},
  {img:"images/card2.png", type:"double", cost:2},
  {img:"images/card3.png", type:"draw", cost:1},
  {img:"images/card4.png", type:"insurance", cost:2},
  {img:"images/card5.png", type:"superspin", cost:3},
  {img:"images/card6.png", type:"manarecover", cost:1},
  {img:"images/card7.png", type:"coinplus", cost:1}
];

function initDeck(){ deck=[]; for(let i=0;i<3;i++){ deck=deck.concat(cardTypes);} shuffle(deck);} 
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
function drawCard(){ if(hand.length>=7)return; if(deck.length===0){ deck=discard; discard=[]; shuffle(deck);} if(deck.length>0){ const card=deck.pop(); hand.push(card); renderHand(); } }
function renderHand(){ const handDiv=document.getElementById("hand"); handDiv.innerHTML=""; hand.forEach((card,idx)=>{ const c=document.createElement("div"); c.className="card"; const img=document.createElement("img"); img.src=card.img; c.appendChild(img); c.onclick=()=>playCard(idx); handDiv.appendChild(c); }); }
function playCard(idx){ const card=hand[idx]; if(mana<card.cost) return; mana-=card.cost; updateStatus(); discard.push(card); hand.splice(idx,1); renderHand(); applyEffect(card); }
function applyEffect(card){ switch(card.type){ case"coinplus": coin+=5; break; case"manarecover": mana+=2; break; case"double": coin*=2; break; case"draw": drawCard(); break;} updateStatus(); }

function spin(){ const bet=20; if(coin<bet){ alert("コイン不足！"); return;} coin-=bet; updateStatus(); document.getElementById("spinBtn").disabled=true;
  for(let r=0;r<3;r++){ spinning[r]=true; document.getElementById("stop"+r).disabled=false; let cells=[document.getElementById("cell"+r),document.getElementById("cell"+(r+3)),document.getElementById("cell"+(r+6))]; spinIntervals[r]=setInterval(()=>{ cells.forEach(cell=>{ const img=document.createElement("img"); img.src=symbols[Math.floor(Math.random()*symbols.length)]; cell.innerHTML=""; cell.appendChild(img); }); },100); }
}

function stopReel(r){ if(!spinning[r])return; clearInterval(spinIntervals[r]); spinIntervals[r]=null; spinning[r]=false; document.getElementById("stop"+r).disabled=true; if(!spinning[0]&&!spinning[1]&&!spinning[2]){ checkWin(); endTurn(); } }

function checkWin(){ const bet=20; let cells=[...Array(9).keys()].map(i=>document.getElementById("cell"+i).firstChild.src);
  // 横
  for(let r=0;r<3;r++){ if(cells[r*3]===cells[r*3+1]&&cells[r*3+1]===cells[r*3+2]){ winReward(bet*5,"横揃い！"); } }
  // 縦
  for(let c=0;c<3;c++){ if(cells[c]===cells[c+3]&&cells[c+3]===cells[c+6]){ winReward(bet*5,"縦揃い！"); } }
  // 斜め
  if(cells[0]===cells[4]&&cells[4]===cells[8]){ winReward(bet*5,"斜め揃い！"); }
  if(cells[2]===cells[4]&&cells[4]===cells[6]){ winReward(bet*5,"斜め揃い！"); }
}
function winReward(amount,msg){ coin+=amount; updateStatus(); alert(msg+" +"+amount+"コイン"); gainXP(2); }

function endTurn(){ mana+=1+manaBonusPerTurn; updateStatus(); drawCard(); document.getElementById("spinBtn").disabled=false; }

function updateStatus(){ document.getElementById("coin").textContent=coin; document.getElementById("mana").textContent=mana; }

// クリッカー
const clickImg=document.getElementById("clickImg");
clickImg.onclick=()=>{
  let gain=clickPower;
  if(Math.random()*100<critRate){ gain=Math.floor(gain*critMult);} coin+=gain; updateStatus(); gainXP(2); };
setInterval(()=>{ if(autoPower>0){ coin+=autoPower; updateStatus(); } },1000);

document.getElementById("upgradeClick").onclick=()=>{ if(mana>=clickCost){ mana-=clickCost; clickPower++; clickCost+=(clickPower-1); document.getElementById("clickCost").textContent=clickCost; updateStatus(); document.getElementById("clickPower").textContent=clickPower; } };
document.getElementById("upgradeAuto").onclick=()=>{ if(mana>=autoCost){ mana-=autoCost; autoPower++; autoCost+=(autoPower-1); document.getElementById("autoCost").textContent=autoCost; updateStatus(); document.getElementById("autoPower").textContent=autoPower; } };

// スキルツリー
function useSkill(cost,fn){ if(skillPoint>0){ skillPoint--; fn(); updateSkillUI(); } }
function updateSkillUI(){ document.getElementById("skillPoint").textContent=skillPoint; document.getElementById("critRate").textContent=critRate; document.getElementById("critMult").textContent=critMult; document.getElementById("autoPower").textContent=autoPower; document.getElementById("clickPower").textContent=clickPower; }

document.getElementById("skillCritRate").onclick=()=>useSkill(1,()=>critRate++);
document.getElementById("skillCritMult").onclick=()=>useSkill(1,()=>critMult+=0.5);
document.getElementById("skillAutoSpeed").onclick=()=>useSkill(1,()=>autoPower++);
document.getElementById("skillClickGain").onclick=()=>useSkill(1,()=>clickPower++);
document.getElementById("skillManaGain").onclick=()=>useSkill(1,()=>manaBonusPerTurn++);

// XP & レベル
function gainXP(amount){ xp+=amount; if(xp>=xpNeeded){ xp-=xpNeeded; level++; xpNeeded=level*5; coin+=10; mana+=2; skillPoint++; alert("LvUP! Lv"+level+" コイン+10 マナ+2 スキルP+1"); } updateXPUI(); }
function updateXPUI(){ document.getElementById("xp").textContent=xp; document.getElementById("xpNeeded").textContent=xpNeeded; document.getElementById("level").textContent=level; document.getElementById("skillPoint").textContent=skillPoint; document.getElementById("xpBar").style.width=(xp/xpNeeded*100)+"%"; document.getElementById("xpBar").textContent=xp+"/"+xpNeeded; }

// 初期化
initDeck(); drawCard(); updateStatus(); updateXPUI();
document.getElementById("stop0").onclick=()=>stopReel(0);
document.getElementById("stop1").onclick=()=>stopReel(1);
document.getElementById("stop2").onclick=()=>stopReel(2);
document.getElementById("spinBtn").onclick=()=>spin();
</script>
</body>
</html>
