<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>1to9 slot</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#0f1724;color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh}
    .wrap{max-width:960px;width:100%;padding:20px;text-align:center}
    .slot-area{display:grid;grid-template-columns:repeat(3,120px);grid-template-rows:repeat(3,150px);gap:8px;justify-content:center;margin:20px auto}
    .cell{width:120px;height:150px;display:flex;align-items:center;justify-content:center;border:2px solid #444;border-radius:8px;background:#111;}
    .cell img{max-width:100%;max-height:100%}
    .panel{display:flex;gap:12px;justify-content:center;margin:12px}
    button{padding:10px 16px;border:none;border-radius:6px;background:#f59e0b;color:#000;font-weight:bold;cursor:pointer}
    .cards{display:flex;gap:12px;justify-content:center;margin-top:16px}
    .card{width:100px;height:150px;border:2px solid #444;border-radius:8px;cursor:pointer;overflow:hidden}
    .card img{width:100%;height:100%;object-fit:cover}
    .selected{border:3px solid #0ff}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>1to9 slot</h1>

    <div class="slot-area" id="slot"></div>

    <div class="panel">
      <button id="spin">SPIN</button>
    </div>

    <h2>カードを選択</h2>
    <div class="cards">
      <div class="card" data-card="reroll"><img src="images/card1.png" alt="Card1"></div>
      <div class="card" data-card="multiplier"><img src="images/card2.png" alt="Card2"></div>
    </div>

    <div id="result"></div>
  </div>

  <script>
    const slotEl = document.getElementById('slot')
    const resultEl = document.getElementById('result')
    let selectedCard = null
    let lastResults = []
    let multiplier = 1

    // スロットの画像（固定）
    const symbols = [
      'images/slot1.png',
      'images/slot2.png',
      'images/slot3.png',
      'images/slot4.png',
      'images/slot5.png',
      'images/slot6.png',
      'images/slot7.png',
      'images/slot8.png',
      'images/slot9.png'
    ]

    // カード選択処理
    document.querySelectorAll('.card').forEach(c=>{
      c.addEventListener('click', ()=>{
        document.querySelectorAll('.card').forEach(cc=>cc.classList.remove('selected'))
        c.classList.add('selected')
        selectedCard = c.dataset.card
      })
    })

    // SPINボタン
    document.getElementById('spin').addEventListener('click', ()=>{
      multiplier = 1
      spinAll()
      if(selectedCard){
        applyCard(selectedCard)
        selectedCard = null
        document.querySelectorAll('.card').forEach(c=>c.classList.remove('selected'))
      }
      checkWin()
    })

    function spinAll(){
      slotEl.innerHTML = ''
      lastResults = []
      for(let r=0;r<3;r++){
        const row = []
        for(let c=0;c<3;c++){
          const index = Math.floor(Math.random()*symbols.length)
          row.push(index)
          const cell = document.createElement('div')
          cell.className = 'cell'
          cell.innerHTML = `<img src="${symbols[index]}">`
          slotEl.appendChild(cell)
        }
        lastResults.push(row)
      }
    }

    function applyCard(card){
      if(card==="reroll"){
        // ランダムに1列を選んで再抽選
        const col = Math.floor(Math.random()*3)
        for(let r=0;r<3;r++){
          const index = Math.floor(Math.random()*symbols.length)
          lastResults[r][col] = index
          slotEl.children[r*3+col].innerHTML = `<img src="${symbols[index]}">`
        }
        resultEl.innerHTML = "カード効果: 1列をリロール！"
      }else if(card==="multiplier"){
        multiplier = 2
        resultEl.innerHTML = "カード効果: 配当2倍！"
      }
    }

    function checkWin(){
      let lines = []
      // 横
      for(let r=0;r<3;r++){
        if(lastResults[r][0]===lastResults[r][1] && lastResults[r][1]===lastResults[r][2]){
          lines.push(`横${r+1}`)
        }
      }
      // 縦
      for(let c=0;c<3;c++){
        if(lastResults[0][c]===lastResults[1][c] && lastResults[1][c]===lastResults[2][c]){
          lines.push(`縦${c+1}`)
        }
      }
      // 斜め
      if(lastResults[0][0]===lastResults[1][1] && lastResults[1][1]===lastResults[2][2]) lines.push("斜め↘")
      if(lastResults[0][2]===lastResults[1][1] && lastResults[1][1]===lastResults[2][0]) lines.push("斜め↙")

      if(lines.length>0){
        resultEl.innerHTML += `<br>当たり! ライン: ${lines.join(", ")} <br>報酬: ${lines.length*5*multiplier} コイン`
      }else{
        resultEl.innerHTML += "<br>ハズレ…"
      }
    }

    // 初期スピン
    spinAll()
  </script>
</body>
</html>
